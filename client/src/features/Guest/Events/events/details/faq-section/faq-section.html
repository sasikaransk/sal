<section class="block" *ngIf="loaded()" aria-labelledby="faq-heading">
  <div class="block-head">
    <h2 id="faq-heading">FAQ</h2>
    <span class="count">{{ faqs().length }}</span>
  </div>
  <div class="faq-toolbar">
    <div class="left">
      <button type="button" class="btn-link" (click)="expandAll()" [disabled]="!visibleFaqs().length">Expand all</button>
      <button type="button" class="btn-link" (click)="collapseAll()" [disabled]="!expandedAny()">Collapse all</button>
    </div>
    <div class="right">
      <button type="button" class="btn-ask" (click)="openAskModal()" aria-label="Ask a question">
        <svg class="icon" aria-hidden="true" viewBox="0 0 24 24" width="18" height="18">
          <defs>
            <linearGradient id="faqGrad" x1="0" x2="1" y1="0" y2="1">
              <stop offset="0%" stop-color="#c88b35"/>
              <stop offset="100%" stop-color="#d8a24a"/>
            </linearGradient>
          </defs>
          <path fill="url(#faqGrad)" d="M12 2a10 10 0 1 0 0 20 10 10 0 0 0 0-20Zm0 14.75a1.25 1.25 0 1 1 0 2.5 1.25 1.25 0 0 1 0-2.5Zm0-11.5c-2.28 0-3.875 1.316-4.12 3.213a1 1 0 0 0 .99 1.137h.007c.509 0 .934-.375.996-.88.125-1.02.97-1.72 2.127-1.72 1.18 0 2.093.765 2.093 1.795 0 .79-.365 1.263-1.353 1.877-.98.608-1.898 1.397-1.898 2.842v.214c0 .552.448 1 1 1s1-.448 1-1v-.214c0-.758.357-1.09 1.33-1.69 1.115-.69 1.92-1.633 1.92-3.03 0-2.018-1.69-3.544-4.02-3.544Z"/>
        </svg>
        <span>Ask a Question</span>
      </button>
    </div>
  </div>
  <ng-container *ngIf="visibleFaqs().length; else emptyFaq">
    <dl class="faq-list">
      <div class="faq-item" *ngFor="let f of visibleFaqs(); let i = index; trackBy: trackFaq">
        <dt class="question">
          <button type="button"
                  class="q-btn"
                  [attr.aria-controls]="'faq-'+i"
                  [attr.aria-expanded]="isExpanded(i)"
                  (click)="toggle(i)">
            <span class="q-text">{{ f.question }}</span>
            <span class="chev" [class.open]="isExpanded(i)" aria-hidden="true">▾</span>
          </button>
        </dt>
        <dd [id]="'faq-'+i" class="answer" [class.pending]="!f.answer" [class.open]="isExpanded(i)">
          {{ f.answer || 'Pending answer from support team…' }}
        </dd>
      </div>
    </dl>
    <div class="actions align-end" *ngIf="faqs().length > showCount()">
      <button type="button" class="btn-primary" (click)="showMore()">Show more ({{ faqs().length - showCount() }})</button>
    </div>
    <div class="actions align-end" *ngIf="showCount() > pageSize">
      <button type="button" class="btn-primary" (click)="showLess()">Show less</button>
    </div>
  </ng-container>
  <ng-template #emptyFaq>
    <div class="empty">No questions yet. Be the first to ask!</div>
  </ng-template>

  <div class="loading" *ngIf="loading()" aria-hidden="true">Loading FAQs...</div>
  <app-ask-question *ngIf="showAsk()" (cancel)="closeAskModal()" (submitQuestion)="handleSubmit($event)"></app-ask-question>

  <div class="toast" *ngIf="toastMessage()" [class.error]="toastType()==='error'" role="status" aria-live="polite">{{ toastMessage() }}</div>
</section>